var bow={},arrow={},calculate={bow:{},arrow:{}},update={},centerCutOptionHTML="",findClosest=function(key,search,items){var closestIndex,closestDiff;$.each(items,function(i,item){var thisNumber=Number(item[key]),thisDiff=Math.abs(thisNumber-Number(search));if(!closestDiff||thisDiff<closestDiff){closestIndex=i;closestDiff=thisDiff}if(closestDiff===0){return}});return items[closestIndex]};calculate.arrow.dynamicSpine=function(){arrow.dynamicSpine=(26/(arrow.deflection_26*(1+(arrow.length-29-arrow.woodShaftLengthOffset-arrow.footingLength)/29*2.8)*(1+((arrow.pointWeight+arrow.insertWeight+arrow.footingWeight+(arrow.footingLength*arrow.gpi)-125-arrow.fletch.fletchValue+10-arrow.totalNockWeight)/125*0.4))))+((26/(arrow.deflection_26*(1+(arrow.length-29-arrow.woodShaftLengthOffset-arrow.footingLength)/29*2.8)*(1+((arrow.pointWeight+arrow.insertWeight+arrow.footingWeight+(arrow.footingLength*arrow.gpi)-125-arrow.fletch.fletchValue+10-arrow.totalNockWeight)/125*0.4))))*9.5-arrow.totalWeight)*0.025+(arrow.shaftDiameter-11/32)*30;arrow.dynamicSpine=($.isNumeric(arrow.dynamicSpine))?math.round(arrow.dynamicSpine,1):0;return arrow.dynamicSpine};calculate.bow.dynamicSpine=function(){bow.dynamicSpine=bow.efficiency*(bow.factoryWeight+(bow.yourDrawLength-bow.factoryDrawLength)*(3+(math.log((bow.factoryWeight/(241-bow.factoryWeight)+2.4),1.138)-7.59)*3))*bow.stringValue*(1+(0.015*bow.personalCalibration))+bow.strikeValue;bow.dynamicSpine=($.isNumeric(bow.dynamicSpine))?math.round(bow.dynamicSpine,1):0;return bow.dynamicSpine};calculate.arrow.totalWeight=function(){arrow.totalWeight=arrow.gpi*arrow.length+arrow.pointWeight+arrow.insertWeight+arrow.fletch.fletchValue+arrow.totalNockWeight+arrow.footingWeight;arrow.totalWeight=($.isNumeric(arrow.totalWeight))?math.round(arrow.totalWeight,1):0;return arrow.totalWeight};calculate.arrow.specificWeight=function(){arrow.specificWeight=arrow.totalWeight/(bow.factoryWeight+(bow.yourDrawLength-bow.factoryDrawLength)*(3+Math.log(bow.factoryWeight/(100-bow.factoryWeight))*3));arrow.specificWeight=($.isNumeric(arrow.specificWeight))?math.round(arrow.specificWeight,1):0;return arrow.specificWeight};calculate.arrow.foc=function(){arrow.foc=(arrow.length/2-((arrow.gpi*arrow.length*arrow.length)/2+arrow.fletch.fletchValue*(arrow.length-2.5)+arrow.length*arrow.totalNockWeight)/(arrow.pointWeight+arrow.insertWeight+arrow.footingLength+(arrow.gpi*arrow.length)+arrow.fletch.fletchValue+arrow.totalNockWeight))/arrow.length*100;arrow.foc=($.isNumeric(arrow.foc))?math.round(arrow.foc,1):0;return arrow.foc};calculate.arrow.speed=function(){arrow.speed=200/(Math.log10(arrow.totalWeight/(bow.efficiency*(bow.factoryWeight+(bow.yourDrawLength-bow.factoryDrawLength)*(3+Math.log(bow.factoryWeight/(100-bow.factoryWeight))*3))*(bow.stringValue-0.05)),10))-20;arrow.speed=($.isNumeric(arrow.speed))?math.round(arrow.speed,1):0;return arrow.speed};calculate.arrow.energy=function(){arrow.energy=(arrow.totalWeight/451080)*Math.pow(arrow.speed,2);arrow.energy=($.isNumeric(arrow.energy))?math.round(arrow.energy,1):0;return arrow.energy};update.bow=function(){var bowID=$("#js-bowName").val();if(!bowID){return}bow=_.findWhere(bowdata,{id:bowID});bow.riserCut=Number(bow.riserCut);if(bow.riserCut===-9999){if($("#js-bowCenterCut").html()!==centerCutOptionHTML){$("#js-bowCenterCut").html(centerCutOptionHTML)}$("#js-bowCenterCut").removeAttr("readonly");$("#js-bowHasStrikePlate-row").slideUp("fast");$("#js-bowHasStrikePlate").val("");$("#js-bowStrikePlateThickness").val(0);bow.searchStrikePos=bow.centerCut}else{$("#js-bowCenterCut").html("<option>"+bow.riserCut+"</option>");$("#js-bowCenterCut").attr("readonly","readonly");$("#js-bowHasStrikePlate-row").slideDown("fast");bow.searchStrikePos=bow.riserCut}if($("#js-bowHasStrikePlate").val()==="Yes"){bow.searchStrikePos+=Number($("#js-bowStrikePlateThickness").val());$("#js-bowStrikePlateThickness-row").slideDown("fast")}else{$("#js-bowStrikePlateThickness-row").slideUp("fast")}bow.centerCut=Number($("#js-bowCenterCut").val());bow.closestStrike=findClosest("strikePos",bow.searchStrikePos,strikedata);bow.strikeValue=Number(bow.closestStrike.strikeValue);bow.efficiency=Number(bow.efficiency);bow.factoryDrawLength=Number($("#js-bowFactoryDrawLength").val());bow.factoryWeight=Number($("#js-bowFactoryWeight").val());bow.personalCalibration=Number($("#js-personalCalibration").val());bow.strikePlateThickness=Number($("#js-bowStrikePlateThickness").val());bow.stringValue=Number($("#js-bowStringType").val());bow.yourDrawLength=Number($("#js-bowYourDrawLength").val());calculate.bow.dynamicSpine()};update.arrow=function(){var arrowID=$("#js-arrowShaft").val();if(!arrowID){return}arrow=_.findWhere(arrowdata,{id:arrowID});arrow.fletch={};arrow.woodShaftLengthOffset=(arrow.shaft==="Wood Shaft")?-0.9:0;if(arrow.shaft==="Wood Shaft"||arrow.shaft==="Other"){arrow.deflection_26=26/Number($("#js-arrowStaticSpine").val());arrow.gpi=Number($("#js-arrowGPI").val());arrow.shaftDiameter=Number($("#js-arrowShaftDiameter").val());$("#js-arrowStaticSpine-row").slideDown("fast");$("#js-arrowGPI-row").slideDown("fast");$("#js-arrowShaftDiameter-row").slideDown("fast")}else{arrow.deflection_26=Number(arrow.deflection_26);arrow.gpi=Number(arrow.gpi);arrow.shaftDiameter=Number(arrow.shaftDiameter);$("#js-arrowStaticSpine-row").slideUp("fast");$("#js-arrowGPI-row").slideUp("fast");$("#js-arrowShaftDiameter-row").slideUp("fast")}arrow.weight=Number(arrow.weight_29);arrow.length=Number($("#js-arrowLength").val());arrow.pointWeight=Number($("#js-arrowPointWeight").val());arrow.insertWeight=Number($("#js-arrowInsertWeight").val());arrow.isFooted=($("#js-arrowHasFootedShafts").val()==="Yes");arrow.footingLength=(arrow.isFooted)?Number($("#js-arrowFootingLength").val()):0;arrow.footingWeight=(arrow.isFooted)?Number($("#js-arrowFootingWeight").val()):0;arrow.totalNockWeight=Number($("#js-arrowTotalNockWeight").val());arrow.staticSpine=Number($("#js-arrowStaticSpine").val());arrow.otherFeatherWeight=Number($("#js-arrowOtherFeatherWeight").val());arrow.fletch.id=$("#js-arrowFletchingType").val();if($.isNumeric(arrow.fletch.id)){arrow.fletch=_.findWhere(fletchdata,{id:arrow.fletch.id});if(arrow.fletch.fletchType==="Other"){arrow.fletch.fletchValue=arrow.otherFeatherWeight;$("#js-arrowOtherFeatherWeight-row").slideDown("fast")}else{arrow.fletch.fletchValue=Number(arrow.fletch.fletchValue);$("#js-arrowOtherFeatherWeight-row").slideUp("fast")}}if(arrow.isFooted){$("#js-arrowFootingLength-row").slideDown("fast");$("#js-arrowFootingWeight-row").slideDown("fast")}else{$("#js-arrowFootingLength-row").slideUp("fast");$("#js-arrowFootingWeight-row").slideUp("fast")}calculate.arrow.totalWeight();calculate.arrow.specificWeight();calculate.arrow.foc();calculate.arrow.speed();calculate.arrow.energy();calculate.arrow.dynamicSpine()};update.display=function(){update.bow();update.arrow();$("#js-bowDynamicSpine").val(bow.dynamicSpine);$(".js-bowDynamicSpine").text(bow.dynamicSpine);$("#js-arrowDynamicSpine").val(arrow.dynamicSpine);$(".js-arrowDynamicSpine").text(arrow.dynamicSpine);$("#js-arrowTotalWeight").val(arrow.totalWeight);$(".js-arrowTotalWeight").text(arrow.totalWeight);$("#js-arrowSpecificWeight").val(arrow.specificWeight);$(".js-arrowSpecificWeight").text(arrow.specificWeight);$("#js-frontOfCenter").val(arrow.foc);$(".js-frontOfCenter").text(arrow.foc);$("#js-arrowSpeed").val(arrow.speed);$(".js-arrowSpeed").text(arrow.speed);$("#js-arrowEnergy").val(arrow.energy);$(".js-arrowEnergy").text(arrow.energy)};var populateSelects=function(){var selects=[{selector:"#js-bowName",data:"bowdata",value:"id",option:"bow"},{selector:"#js-bowCenterCut",data:"centercutdata",value:"measurement",option:"measurement"},{selector:"#js-bowStringType",data:"stringdata",value:"stringValue",option:"stringType"},{selector:"#js-arrowShaft",data:"arrowdata",value:"id",option:"shaft"},{selector:"#js-arrowFletchingType",data:"fletchdata",value:"id",option:"fletchType"}];$.each(selects,function(i,select){var html="";$.each(window[select.data],function(index,data){html+='<option value="'+data[select.value]+'">'+data[select.option]+"</option>"});$(select.selector).append(html)})};$(function(){$.when($.getJSON("/spinecalc/index.php?data_only=1",function(json,textStatus){for(var key in json){if(json.hasOwnProperty(key)){var obj=json[key];window[key]=obj}}})).done(function(){populateSelects();centerCutOptionHTML=$("#js-bowCenterCut").html();$("input, select").on("input change",update.display);$(".js-trigger-recalc").on("click",update.display);update.display()})});$(".arrowInf").click(function(e){e.preventDefault();$(".arrowInf").hide();$(".increment").css("background-color","#cdcdcd");$(".spcl-right, .personalForm").slideDown();$(".secondincrement").css("background-color","#f8c364");$("#spcl-tab1").removeClass("highlighted");$("#spcl-tab2").addClass("highlighted")});$(".js-spine-calc-form").on("submit",function(e){e.preventDefault();$(".results").slideDown();$(window).scrollTop($(".results").offset().top,500);$("#spcl-tab2").removeClass("highlighted");$("#spcl-tab3").addClass("highlighted");$(".increment").css("background-color","#cdcdcd");$(".js-count-me").each(function(){$el=$(this);$el.countTo({from:0,to:$el.text(),speed:1000,refreshInterval:50,decimals:1})})});